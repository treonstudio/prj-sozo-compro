<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Temukan Cabang Terdekat</title>
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Leaflet CSS & JS (CDN) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  <style>
    /* Fix Leaflet tiles and container height in flex boxes */
    #map { height: 100%; width: 100%; }
    .leaflet-container { font: inherit; }
    .custom-popup .leaflet-popup-content-wrapper { border-radius: 12px; }
  </style>
</head>
<body class="min-h-screen bg-slate-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <!-- Header -->
    <h1 class="text-3xl sm:text-4xl font-bold text-center text-slate-800">Temukan Cabang Terdekat di Kotamu</h1>

    <!-- Region Filter -->
    <div class="mt-6 flex justify-center">
      <div id="region-filter" class="flex flex-wrap gap-2 justify-center">
        <!-- Buttons injected by JS -->
      </div>
    </div>

    <!-- Content -->
    <div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6 items-start">
      <!-- Left: List Card -->
      <div class="w-full h-[520px] sm:h-[560px] lg:h-[620px] bg-white rounded-xl border border-slate-200 shadow flex flex-col">
        <div class="p-4 sm:p-6 border-b border-slate-100">
          <div class="relative">
            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400">ðŸ”Ž</span>
            <input id="search" type="text" placeholder="Temukan Cabang Terdekat" class="w-full pl-10 pr-3 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-slate-700 placeholder-slate-400" />
          </div>
        </div>
        <div id="list" class="px-4 sm:px-6 py-4 overflow-y-auto grow space-y-4"></div>
      </div>

      <!-- Right: Map Card -->
      <div class="h-[520px] sm:h-[560px] lg:h-[620px] bg-white rounded-xl border border-slate-200 shadow overflow-hidden">
        <div id="map"></div>
      </div>
    </div>
  </div>

  <script>
    // Sample data (you can replace with your own)
    const clinics = [
      {
        id: '1',
        name: 'Sozo Skin Clinic Yogyakarta',
        address: 'Jl. Pangeran Diponegoro No.58, Gowongan, Kec. Jetis, Kota Yogyakarta, DIY 55233',
        phone: '(0274) 123456',
        rating: 4.8,
        city: 'Yogyakarta',
        region: 'jawa',
        services: ['Skin Treatment', 'Consultation', 'Laser'],
        image: 'https://images.unsplash.com/photo-1584982751622-5f2f3f80ca32?w=256&q=80&auto=format&fit=crop',
        coordinates: [-7.7829, 110.3671],
      },
      {
        id: '2',
        name: 'Jakarta Timur - Duren Sawit',
        address: 'Jl. Raden Inten II No.66, RT.7/RW.7, Duren Sawit, Jakarta Timur',
        phone: '(021) 987654',
        rating: 4.6,
        city: 'Jakarta',
        region: 'jabodetabek',
        services: ['General', 'Dermatology'],
        image: 'https://images.unsplash.com/photo-1576765607924-b87ca04efac3?w=256&q=80&auto=format&fit=crop',
        coordinates: [-6.225, 106.903],
      },
      {
        id: '3',
        name: 'Jakarta Utara - Kelapa Gading',
        address: 'Jl. Boulevard Artha Gading, Kelapa Gading, Jakarta Utara',
        phone: '(021) 556677',
        rating: 4.7,
        city: 'Jakarta',
        region: 'jabodetabek',
        services: ['Aesthetic', 'Laser'],
        image: 'https://images.unsplash.com/photo-1551601651-2a8555f1a136?w=256&q=80&auto=format&fit=crop',
        coordinates: [-6.158, 106.905],
      },
      {
        id: '4',
        name: 'Jakarta Barat - Kemanggisan',
        address: 'Jl. Kemanggisan Raya No.42, Palmerah, Jakarta Barat',
        phone: '(021) 223344',
        rating: 4.5,
        city: 'Jakarta',
        region: 'jabodetabek',
        services: ['Consultation', 'Treatment'],
        image: 'https://images.unsplash.com/photo-1579684385127-1ef15d508118?w=256&q=80&auto=format&fit=crop',
        coordinates: [-6.201, 106.788],
      },
    ];

    const regions = [
      { id: 'jabodetabek', name: 'Jabodetabek' },
      { id: 'jawa', name: 'Jawa' },
      { id: 'sumatra', name: 'Sumatra' },
      { id: 'bali', name: 'Bali' },
      { id: 'kalimantan', name: 'Kalimantan' },
      { id: 'sulawesi', name: 'Sulawesi' },
    ];

    // State
    let searchTerm = '';
    let selectedRegion = 'all';
    let selectedClinic = null;

    // DOM refs
    const $filter = document.getElementById('region-filter');
    const $list = document.getElementById('list');
    const $search = document.getElementById('search');

    // Render Region Buttons
    function renderRegions() {
      const allBtn = btn('Semua', selectedRegion === 'all', () => { selectedRegion = 'all'; render(); fitAll(); });
      $filter.innerHTML = '';
      $filter.appendChild(allBtn);
      regions.forEach(r => {
        const b = btn(r.name, selectedRegion === r.id, () => { selectedRegion = r.id; render(); fitAll(); });
        $filter.appendChild(b);
      });

      function btn(text, active, onClick) {
        const b = document.createElement('button');
        b.className = `px-4 py-2 rounded-full text-sm font-medium transition-colors border ${active ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-slate-700 hover:bg-slate-50 border-slate-300'}`;
        b.textContent = text;
        b.onclick = onClick;
        return b;
      }
    }

    // Filtered clinics
    function getFiltered() {
      return clinics.filter(c => {
        const matchesSearch = !searchTerm ||
          c.name.toLowerCase().includes(searchTerm) ||
          c.city.toLowerCase().includes(searchTerm) ||
          c.address.toLowerCase().includes(searchTerm);
        const matchesRegion = selectedRegion === 'all' || c.region === selectedRegion;
        return matchesSearch && matchesRegion;
      });
    }

    // Render Clinic List
    function renderList(items) {
      $list.innerHTML = '';
      if (items.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'text-center py-8 text-slate-500';
        empty.textContent = 'Tidak ada klinik yang ditemukan';
        $list.appendChild(empty);
        return;
      }

      items.forEach(c => {
        const card = document.createElement('div');
        card.className = `p-4 rounded-lg border cursor-pointer transition-all duration-300 hover:shadow-md ${selectedClinic && selectedClinic.id === c.id ? 'border-orange-300 bg-orange-50 shadow-md' : 'border-slate-200 bg-white hover:border-blue-300'}`;
        card.onclick = () => { selectedClinic = c; focusMarker(c); };

        card.innerHTML = `
          <div class="flex gap-4">
            <img src="${c.image}" alt="${c.name}" class="w-16 h-16 rounded-lg object-cover flex-shrink-0" />
            <div class="flex-1 min-w-0">
              <h3 class="font-semibold text-slate-800 mb-1 truncate">${c.name}</h3>
              <p class="text-sm text-slate-600 line-clamp-2">${c.address}</p>
              <div class="flex items-center gap-4 my-2 text-sm">
                <span class="text-green-600">${c.phone}</span>
                <span class="text-amber-600 font-medium">â˜… ${c.rating}</span>
              </div>
              <div class="flex flex-wrap gap-1 mb-2">
                ${c.services.slice(0,2).map(s => `<span class='px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full'>${s}</span>`).join('')}
                ${c.services.length>2 ? `<span class='px-2 py-1 bg-slate-100 text-slate-600 text-xs rounded-full'>+${c.services.length-2}</span>` : ''}
              </div>
              <button class="mt-3 w-full py-2 px-4 rounded-full text-sm font-medium transition-colors border border-blue-400 text-blue-700 hover:bg-blue-50">Explore Treatment</button>
            </div>
          </div>
        `;
        $list.appendChild(card);
      });
    }

    // Map init
    const map = L.map('map').setView([-6.2088, 106.8456], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors',
    }).addTo(map);

    // Markers
    const markers = new Map();

    function createIcon(selected = false) {
      const svg = `
        <svg width="30" height="40" viewBox="0 0 30 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M15 0C6.7 0 0 6.7 0 15C0 22.5 15 40 15 40S30 22.5 30 15C30 6.7 23.3 0 15 0Z" fill="${selected ? '#f97316' : '#2563eb'}"/>
          <circle cx="15" cy="15" r="8" fill="white"/>
          <path d="M15 10C12.8 10 11 11.8 11 14C11 16.2 12.8 18 15 18C17.2 18 19 16.2 19 14C19 11.8 17.2 10 15 10Z" fill="${selected ? '#f97316' : '#2563eb'}"/>
        </svg>`;
      return L.icon({
        iconUrl: 'data:image/svg+xml;base64,' + btoa(svg),
        iconSize: [30, 40],
        iconAnchor: [15, 40],
        popupAnchor: [0, -40],
      });
    }

    function renderMarkers(items) {
      // remove old
      markers.forEach(m => map.removeLayer(m));
      markers.clear();

      items.forEach(c => {
        const m = L.marker(c.coordinates, { icon: createIcon(selectedClinic && selectedClinic.id === c.id) })
          .addTo(map)
          .bindPopup(`
            <div class='custom-popup p-2 min-w-[250px]'>
              <div class='font-semibold text-slate-800 mb-1'>${c.name}</div>
              <div class='text-sm text-slate-600 mb-2'>${c.address}</div>
              <div class='flex items-center gap-3 text-sm'>
                <span class='text-green-600'>${c.phone}</span>
                <span class='text-amber-600 font-medium'>â˜… ${c.rating}</span>
              </div>
            </div>
          `);
        m.on('click', () => { selectedClinic = c; renderList(getFiltered()); renderMarkers(getFiltered()); });
        markers.set(c.id, m);
      });
    }

    function focusMarker(c) {
      map.setView(c.coordinates, 15);
      const m = markers.get(c.id);
      if (m) { m.openPopup(); }
      renderMarkers(getFiltered());
      renderList(getFiltered());
    }

    function fitAll() {
      const items = getFiltered();
      if (items.length === 0) return;
      const group = L.featureGroup(items.map(c => L.marker(c.coordinates)));
      map.fitBounds(group.getBounds().pad(0.2));
    }

    function render() {
      const items = getFiltered();
      renderList(items);
      renderMarkers(items);
    }

    // Wire search
    $search.addEventListener('input', (e) => {
      searchTerm = e.target.value.trim().toLowerCase();
      render();
      fitAll();
    });

    // Initial
    renderRegions();
    render();
    fitAll();
  </script>
</body>
</html>
